It would probably be possible to find an algorithm which makes it work but the problem is, that you don't know which indexes could be read already and which ones are free to read. So i wouldn't use a semaphore in this situation.
